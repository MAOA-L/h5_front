<!DOCTYPE html>
<html>
<head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <!--    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection"/>-->
    <link type="text/css" rel="stylesheet" href="../css/materialize.css" media="screen,projection"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body>
<div class="container">
    <ul class="collapsible">
        <!--        <li>-->
        <!--            <div class="collapsible-header">-->
        <!--                <i class="material-icons">filter_drama</i>-->
        <!--                First-->
        <!--                <span class="new badge">4</span></div>-->
        <!--            <div class="collapsible-body"><p>Lorem ipsum dolor sit amet.</p></div>-->
        <!--        </li>-->
        <!--        <li>-->
        <!--            <div class="collapsible-header">-->
        <!--                <i class="material-icons">place</i>-->
        <!--                Second-->
        <!--                <span class="badge">1</span></div>-->
        <!--            <div class="collapsible-body"><p>Lorem ipsum dolor sit amet.</p></div>-->
        <!--        </li>-->
    </ul>
</div>

<script type="text/javascript" src="../js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../js/materialize.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var elems = document.querySelectorAll('.collapsible');
        var instances = M.Collapsible.init();
    });

    $(document).ready(function () {
        $('.collapsible').collapsible();
    });
</script>
<script>
    $.ajax({
        url: 'http://busapi.cyanzoy.top/v1/bus/getBusInfo/',
        type: 'GET',
        dataType: 'json',
        success: function (res) {
            if (res.errcode === 0) {
                M.toast({html: 'success', classes: 'rounded'})
            }
            init_bus_info(res.data.list)
        }

    })

    function init_bus_info(data) {
        // var b = [{"num": 111, "mark": 'xxx'}, {"num": 222}]
        data.forEach((e) => {
            console.log(e, e["num"])
            var number = e['number']
            var departure_station = e['departure_station']
            var destination = e['destination']
            var mark = e['mark']
            var station = ''
            var id = e['id']
            if (departure_station) {
                station += departure_station
            }
            if (destination) {
                station += destination
            }
            var s = '<li>\n' +
                '            <div class="collapsible-header">\n' +
                '                <i class="material-icons">directions_bus</i>\n' + number +
                '                <span class="badge">' + station + '</span></div>\n' +
                '            <div class="collapsible-body"><p>' +
                '<button class="btn waves-effect waves-light" name="real_btn" data-id=' + id + '>查看实况' +
                '<i class="material-icons right">send</i>\n' +
                '</button>' +
                '' + mark + '</p></div>\n' +
                '</li>'
            $('.collapsible').append(s)
        })
    }

    $(document).on('click', 'button[name="real_btn"]', function () {
        console.log("a")
        var a = $(this).attr('data-id')
        M.toast({html: a, classes: 'rounded'})
    })

</script>
</body>
</html>